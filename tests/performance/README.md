# 性能测试文档

本目录包含 GraphRAG 项目的性能测试和基准测试脚本。

## 📁 目录结构

```
tests/performance/
├── __init__.py
├── README.md                    # 本文件
├── benchmark_retrieval.py       # 检索策略性能对比测试
├── benchmark_context.py         # 上下文增强效果测试
├── benchmark_cache.py           # 缓存性能测试
├── benchmark_schema_inference.py # 模式推断性能测试
├── benchmark_concurrent.py      # 并发性能测试
├── benchmark_end_to_end.py      # 端到端性能测试
└── utils.py                     # 性能测试工具函数
```

## 🎯 测试目标

### 1. 检索策略对比
- **纯向量检索** vs **纯知识图谱检索** vs **混合检索**
- 测量指标：响应时间、准确率、召回率、置信度

### 2. 上下文增强效果
- **无增强** vs **有上下文增强**
- 测量指标：指代理解准确率、多轮对话连贯性

### 3. 缓存性能
- **无缓存** vs **Redis 缓存**
- 测量指标：缓存命中率、响应时间加速比

### 4. 模式推断性能
- **手动定义** vs **自动推断**
- **单行数据** vs **多行数据推断**
- 测量指标：推断时间、准确率

### 5. 并发性能
- 不同并发数下的系统表现
- 测量指标：QPS、响应时间分布、错误率

### 6. 端到端性能
- 完整问答流程的性能表现
- 测量指标：总响应时间、各阶段耗时分布

## 🚀 运行测试

### 运行所有性能测试

```bash
# 从项目根目录运行
python -m pytest tests/performance/ -v
```

### 运行特定测试

```bash
# 检索策略对比
python tests/performance/benchmark_retrieval.py

# 上下文增强测试
python tests/performance/benchmark_context.py

# 缓存性能测试
python tests/performance/benchmark_cache.py

# 并发性能测试
python tests/performance/benchmark_concurrent.py
```

## 📊 测试数据

### 标准测试数据集

建议准备以下测试数据：

1. **标准问答集**：100-500 个问题
   - 简单查询（30%）：单实体、单关系
   - 中等查询（50%）：多实体、多关系
   - 复杂查询（20%）：多跳查询、聚合查询

2. **多轮对话集**：50-100 个对话场景
   - 包含指代性问题的对话
   - 主题延续的对话

3. **压力测试场景**
   - 10/50/100 并发用户
   - 不同数据规模（1K/10K/100K 条记录）

## 📈 性能指标说明

### 响应时间指标
- **平均响应时间**：所有请求的平均耗时
- **P50（中位数）**：50% 的请求在此时间内完成
- **P95**：95% 的请求在此时间内完成
- **P99**：99% 的请求在此时间内完成

### 准确率指标
- **答案正确率**：人工评估或与标准答案对比
- **查询成功率**：成功生成并执行查询的比例
- **召回率**：相关结果覆盖的比例

### 系统指标
- **QPS（每秒查询数）**：系统吞吐量
- **并发数**：同时处理的请求数
- **错误率**：失败请求占总请求的比例
- **资源占用**：CPU、内存、数据库连接数

## 🔧 前置条件

运行性能测试前，确保以下服务已启动：

- ✅ Neo4j 数据库已启动并配置
- ✅ Milvus 向量数据库已启动
- ✅ Redis 服务已启动（缓存测试需要）
- ✅ 环境变量已正确配置（API Key 等）
- ✅ 测试数据已导入（图谱和向量库）

## 📝 测试报告

测试完成后，会生成以下报告：

- **性能对比报告**：各策略的指标对比表格
- **性能图表**：响应时间分布、准确率对比等
- **详细日志**：每次测试的详细执行记录

## 🔗 相关链接

- [主文档](../../docs/README.md)
- [架构文档](../../docs/architecture/technical_workflow.md)
- [测试文档](../README.md)

